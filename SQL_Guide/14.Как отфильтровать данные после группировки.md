# Как отфильтровать данные после группировки

## Оператор `HAVING`

Для таких случаев существует оператор `HAVING`. Он фильтрует значения, полученные в результате группировки — то есть работает не с новыми полями, а с результатом вычислений. Его записывают после `GROUP BY`.

Скопировать код

SQL

```
SELECT connection_area,
       AVG(age)
FROM buyer
WHERE company_marker = 0
GROUP BY connection_area
HAVING AVG(age) > 30; 
```

Переведём запрос на «человеческий» язык: подсчитай среднее по каждой зоне подключения, но только для клиентов, которые не являются сотрудниками парка. В итоговой таблице оставь только те результаты, где средний возраст больше тридцати лет.

❗ Ещё раз напомним разницу между `WHERE` и `HAVING`: `WHERE` работает с исходными данными, `HAVING` — с результатом группировки.

## Особенности оператора `HAVING`

1. Условие, по которому оператор `HAVING` фильтрует данные, необязательно указывать в `SELECT`. Например, нужно отобразить зоны парка и максимальный возраст клиентов, которые подключались в них, но исключить те, где средний возраст меньше 30 лет. При этом сам средний возраст можно не выводить на экран.

Скопировать код

SQL

```
SELECT connection_area,
       MAX(age)
FROM buyer
WHERE company_marker = 0
GROUP BY connection_area
HAVING AVG(age) > 30; 
```

2. Все операторы, с которыми вы знакомы, можно комбинировать с `HAVING` — но только при условии, что в запросе есть группировка `GROUP BY`. Без неё `HAVING` работать не будет. Например, такой код приведёт к ошибке:

Скопировать код

SQL

```
SELECT connection_area,
       age
FROM buyer
WHERE company_marker = 0
HAVING age > 30; 
```

