# Как работать с датой и временем
Фильтровать даты и время можно так же, как и обычные числа, но есть несколько нюансов.
## Фильтрация по дате

В таблице `buyer` нет дат, поэтому поработаем с другой таблицей из нашей базы данных. Это таблица `hotdog`, где содержатся данные о заказах хот-догов роботами-автоматами. В поле `date` хранятся даты заказов. Отфильтруем таблицу по датам — отберём заказы, сделанные с 27 февраля 2022 по 14 марта 2022 года. Данные в поле хранятся в формате `YYYY-MM-DD`. Запрос будет выглядеть так:

```
SELECT *
FROM hotdog
WHERE date >= '2022-02-27' AND date <= '2022-03-14'; 
```

У данных в формате даты есть преимущество — из них можно выделять отдельные элементы: годы, месяцы, дни, минуты или секунды.

Для этого используют функции [`DATE_TRUNC`]() и [`EXTRACT`]().
## Функция `DATE_TRUNC`

Дата и время часто хранятся в таком виде: `'2009-11-19 11:03:05'`. Но сравнивать даты в таком формате неудобно, если нужен, например, только год.

В таких случаях в PostegreSQL используют функцию `DATE_TRUNC`, которая «усекает» дату и время до необходимого значения. Синтаксис функции такой: `DATE_TRUNC('отрезок времени', поле)`.

Отрезок времени может быть разным, главное — не забыть одинарные кавычки:

- `'microseconds'` — микросекунды;
- `'milliseconds'` — миллисекунды;
- `'second'` — секунда;
- `'minute'` — минута;
- `'hour'` — час;
- `'day'` — день;
- `'week'` — неделя;
- `'month'` — месяц;
- `'quarter'` — квартал;
- `'year'` — год;
- `'decade'` — десятилетие;
- `'century'` — век.

Функция `DATE_TRUNC` — полезный инструмент, но её аналоги есть не во всех СУБД. Она пригодится, если нужно посчитать записи за конкретный период: например, неделю или месяц.

Разберём, как работает функция `DATE_TRUNC`, на примере таблицы с заказами хот-догов. Таблица `hotdog` содержит поле `date` с типом данных `date`: поле хранит дату заказа в виде `'2022-02-27'`.

Применим функцию `DATE_TRUNC` для этого поля. Для наглядности отобразим исходное поле с датой и поле с выделенным элементом даты. Выведем только первые пять строк:

Скопировать кодSQL

```
SELECT date,
       DATE_TRUNC('month', date)
FROM hotdog
LIMIT 5; 
```

Обратите внимание на одну интересную особенность PostgreSQL. При использовании оператора `DATE_TRUNC` PostgreSQL возвращает данные, которые имеют тип **timestamp with time zone**.

Этот тип данных похож на `date`, только вдобавок содержит время. Кроме того, такой тип производит поправку на временной пояс, в котором находится компьютер пользователя.

Пример: вы усекаете данные до месяца из даты 2023-03-04. После использования `DATE_TRUNC` вы получите следующий результат: 2023-03-01 00.00.00.

При формировании типа `timestamp` к данным добавилось нулевое время, поскольку этот тип обязан его содержать. Так как тип имеет расширение `with time zone`, система сравнит полученный результат с вашим временем. Если ваш часовой пояс отличается от нулевого в меньшую сторону, то дата может измениться: если отнять три часа от 2023-03-01 00.00.00, получится 2023-02-28, то есть последний день предыдущего месяца.

В зависимости от вашего часового пояса при решении задач в тренажёре может отображаться не первый день нужного месяца, а последняя дата предыдущего — по причинам, которые описаны выше.
## Функция `EXTRACT`

Чтобы получить только конкретную часть даты — год, месяц или минуту, — используют функцию `EXTRACT`. Её синтаксис: `EXTRACT(отрезок времени FROM поле)`.

Одинарные кавычки для значений внутри `EXTRACT` не нужны. Отрезок времени можно представить следующими значениями:

- `CENTURY` — век;
- `YEAR` — год;
- `QUARTER` — квартал;
- `MONTH` — месяц;
- `WEEK` — неделя в году;
- `DAY` — день;
- `DOY` (от англ. day of the year) — день года, выраженный числом от 1 до 365 или 366, если год високосный;
- `DOW` (от англ. day of the week) — день недели, выраженный числом от 0 до 6, где понедельник — 1, воскресенье — 0.
- `ISODOW` (от англ. day of the week и ISO 8601) — день недели, выраженный числом от 1 до 7, где понедельник — 1, воскресенье — 7;
- `HOUR` — час;
- `MINUTE` — минута;
- `SECOND` — секунда;
- `MILLISECOND` — миллисекунда.

Выделим номер недели из поля с датой так же, как ранее мы делали с месяцем. На этот раз применим `EXTRACT`:

Скопировать кодSQL

```
SELECT date,
       EXTRACT(WEEK FROM date)
FROM hotdog
LIMIT 5; 
```